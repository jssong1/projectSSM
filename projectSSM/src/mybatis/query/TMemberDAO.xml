<?xml version="1.0" encoding="UTF-8"?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="ssm.mi.member.dao.TMemberMapper">
	<resultMap type = "ssm.mi.member.vo.TMemberVO" id="TMemberVO">
		<result property="ttNo" column="TT_NO" />
		<result property="ttName" column="TT_NAME"/>
		<result property="ttBirth" column="TT_BIRTH" />
		<result property="ttGender" column="TT_GENDER" />
		<result property="ttAuthority" column="TT_AUTHORITY" />
		<result property="sjtCode" column="SJTCODE" />
		<result property="ttId" column="TT_ID" />
		<result property="ttPw" column="TT_PW"/>
		<result property="ttTransferyear" column="TT_TRANSFERYEAR" />
		<result property="ttPn" column="TT_PN" />
		<result property="ttGrade" column="TT_GRADE" />
		<result property="ttClass" column="TT_CLASS" />
		<result property="ttEmail" column="TT_EMAIL" />
		<result property="ttImage" column="TT_IMAGE" />
		<result property="ttDeleteyn" column="TT_DELETEYN" />
		<result property="ttInsertdate" column="TT_INSERTDATE" />
		<result property="ttUpdatedate" column="TT_UPDATEDATE" />	
	</resultMap>
	
	<select id ="listTMember" resultMap="TMemberVO">
		/* Mapper - listTMember*/	
			SELECT TT_NO, TT_NAME, TT_BIRTH, TT_GENDER, TT_AUTHORITY, SJTCODE, TT_ID, TT_PW, TT_TRANSFERYEAR, TT_PN	
			,TT_EMAIL	,TT_IMAGE	,TT_DELETEYN	,TT_INSERTDATE	,TT_UPDATEDATE
			FROM T_MEMBER
			WHERE TT_DELETEYN = 'Y'
			ORDER BY 1
	</select>
	
	
	<!-- 채번 -->
	<select id="selectChaebun" parameterType="String" resultMap="TMemberVO">
	 /* Mapper - selectChaebun */
		 SELECT 
			NVL(MAX(SUBSTR(TT_NO,-4)),0)+1 AS TT_NO 
			FROM T_MEMBER
			WHERE SUBSTR(TT_NO,2,3) = #{ttNo}
	</select>
	
	<insert id="tMemberInsert" parameterType="ssm.mi.member.vo.TMemberVO">
		/*Mapper - tMemberInsert*/
			INSERT INTO T_MEMBER (TT_NO, TT_NAME, TT_BIRTH, TT_GENDER,TT_PN, SJTCODE, TT_TRANSFERYEAR)
			VALUES (#{ttNo},#{ttName} ,#{ttBirth},#{ttGender},#{ttPn},#{sjtCode},#{ttTransferyear})
	</insert>
	
	<select id="joinTMemberCheck" parameterType="ssm.mi.member.vo.TMemberVO" resultMap="TMemberVO">
		/*Mapper - "joinTMemberCheck"*/
		SELECT TT_NO, TT_NAME, TT_BIRTH, TT_GENDER, TT_AUTHORITY, SJTCODE, TT_ID, TT_PW, TT_TRANSFERYEAR, TT_PN				
			FROM T_MEMBER
			WHERE  TT_NAME =#{ttName}
			AND TT_BIRTH =#{ttBirth}
			AND TT_GENDER=#{ttGender}
			AND TT_TRANSFERYEAR=#{ttTransferyear}
			AND TT_PN=#{ttPn}
	</select>
	
	<insert id="joinTMember" parameterType="ssm.mi.member.vo.TMemberVO">
		/*Mapper - "joinTMember"*/
			UPDATE 	T_MEMBER		
			SET 	TT_AUTHORITY		= '0' 
				    ,TT_ID		 	= #{ttId}	
				    ,TT_PW		 	= #{ttPw}
				    ,TT_EMAIL = #{ttEmail}
				    ,TT_IMAGE = #{ttImage}
				    ,TT_GRADE = #{ttGrade}
				    ,TT_CLASS = #{ttClass}
				    ,SJTCODE=#{sjtCode}
				   	,TT_INSERTDATE = SYSDATE	
				    ,TT_UPDATEDATE	= SYSDATE
				    ,TT_DELETEYN = 'Y'	
			WHERE	TT_NAME		= #{ttName}
				AND TT_PN = #{ttPn}
				
				
	</insert>
	
	
</mapper>